# Supabase Rules (ATE9)

## 接続とクライアント
- Supabase との通信は専用モジュール（例: `@/lib/supabase/client.ts`）経由で行う。
- コンポーネント内で直接 `createClient` しない。
- 環境変数や URL / KEY は `.env` 経由で管理し、ハードコードしない。

## API 設計
- Supabase の操作は
  - `repositories`（クエリ層）
  - `services`（ドメインロジック層）
  に分けて、コンポーネントからは **サービス層**のみを呼ぶ。
- ドメインに密接な処理は「クライアント直書き」ではなく  
  Supabase RPC や View も検討する。

## 型
- Supabase の型生成（`Database` 型 等）を利用し、`TableRow` などの型をそこから取得する。
- 戻り値・引数は必ず型付けし、`any` を使用しない。

## エラーハンドリング
- Supabase のレスポンスは `error` を常に確認し、  
  - ユーザー向けメッセージ
  - ログ用メッセージ
  を分けて扱う。
- `throw` する場合は、ドメイン層で扱いやすい独自エラー型に包むことを検討する。

## セキュリティ / RLS
- RLS 前提の設計を意識し、「クライアント側で制御するから大丈夫」という前提で実装しない。
- 認証状態に依存する処理は、**サーバーコンポーネント or サーバーアクション**で行い、
  クライアント側には最小限のデータのみ渡す。
